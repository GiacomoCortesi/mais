import requests
import uuid

class TranscriptionNotFoundException(Exception):
    pass

class TranscriptionService:
    def __init__(self, openai_token):
        self.openai_token = openai_token
        self.transcriptions = {}
    
    def add(self, transcription):
        transcription["transcription_id"] = str(uuid.uuid4())
        self.transcriptions[transcription["transcription_id"]] = transcription
        return transcription
    
    def get_all(self):
        return list(self.transcriptions.values())

    def get(self, transcription_id):
        try:
            return self.transcriptions[transcription_id]
        except KeyError:
            raise TranscriptionNotFoundException

    def edit(self, transcription_id, transcription):
        self.transcriptions[transcription_id]["data"] = transcription["data"]
    
    def delete(self, transcription_id):
        return self.transcriptions.pop(transcription_id)
    
    def fit(self, transcription_id):
        transcription = self.get(transcription_id)
        transcription_data = transcription["data"]
        for index, segment in enumerate(transcription_data["segments"]):
            segment_start = 0
            segment_end = segment["end"]
            if index > 0:
                segment_start = transcription_data["segments"][index - 1]["end"]
            if index < len(transcription_data["segments"])-1:
                segment_end = transcription_data["segments"][index + 1]["start"]
            segment["start"] = segment_start
            segment["end"] = segment_end
        
        transcription["data"] = transcription_data

        self.edit(transcription_id, transcription)

    def fix(self, transcription_id):
        transcription = self.get(transcription_id)
        transcription_data = transcription["data"]
        url = 'https://api.openai.com/v1/chat/completions'
        headers = {
            "Content-Type": "application/json",
            "Authorization": f"Bearer {self.openai_token}"
        }
        prompt = f'''
        The following data contains some text in {transcription_data.get("language", "en")} language code.
        The text may contain incorrect words, attempt to fix incorrect words.
        The text you need to consider is inside the segments array, each element in the array has a text field
        containing the target text. When doing the correction you can try to make meaningful corrections also based on the
        overall context of the text.
        Try to correct as little as possible.
        There may be some word in a different language (or wrongly translated), fix it in the original language but do not translate it.
        Only respond in valid JSON format
        In the returned JSON skip the "word_segments" and "language" keys. Only include the "segments" key.
        In the "segments" object skip the "words" key.
        {transcription_data}
        '''
        data = {
            "response_format": { "type": "json_object" },
            "model": "gpt-3.5-turbo",
            "messages": [{"role": "user", "content": prompt}],
            "temperature": 0.7
        }
        response = requests.post(url, headers=headers, json=data).json()
        transcription["data"]["segments"] = response["segments"]
        self.edit(transcription_id, transcription)
    
if __name__== '__main__':
    transcription = {'segments': [{'start': 1.099, 'end': 2.763, 'text': ' Cialo come il sole', 'words': [{'word': 'Cialo', 'start': 1.099, 'end': 1.4, 'score': 0.491}, {'word': 'come', 'start': 1.58, 'end': 1.921, 'score': 0.587}, {'word': 'il', 'start': 2.041, 'end': 2.081, 'score': 0.157}, {'word': 'sole', 'start': 2.262, 'end': 2.763, 'score': 0.559}]}, {'start': 4.238, 'end': 6.104, 'text': ' che mi scalda il cuore', 'words': [{'word': 'che', 'start': 4.238, 'end': 4.439, 'score': 0.253}, {'word': 'mi', 'start': 4.539, 'end': 4.619, 'score': 0.722}, {'word': 'scalda', 'start': 4.7, 'end': 5.302, 'score': 0.814}, {'word': 'il', 'start': 5.402, 'end': 5.462, 'score': 0.814}, {'word': 'cuore', 'start': 5.643, 'end': 6.104, 'score': 0.904}]}, {'start': 7.556, 'end': 9.306, 'text': ' e blu come il mare.', 'words': [{'word': 'e', 'start': 7.556, 'end': 7.616, 'score': 0.531}, {'word': 'blu', 'start': 7.737, 'end': 7.918, 'score': 0.709}, {'word': 'come', 'start': 8.079, 'end': 8.541, 'score': 0.774}, {'word': 'il', 'start': 8.682, 'end': 8.722, 'score': 0.255}, {'word': 'mare.', 'start': 8.803, 'end': 9.306, 'score': 0.681}]}, {'start': 10.646, 'end': 12.604, 'text': ' che sei mi consopla.', 'words': [{'word': 'che', 'start': 10.646, 'end': 10.828, 'score': 0.488}, {'word': 'sei', 'start': 10.949, 'end': 11.232, 'score': 0.777}, {'word': 'mi', 'start': 11.312, 'end': 11.454, 'score': 0.95}, {'word': 'consopla.', 'start': 11.635, 'end': 12.604, 'score': 0.918}]}, {'start': 13.844, 'end': 16.123, 'text': ' verde come campiche', 'words': [{'word': 'verde', 'start': 13.844, 'end': 14.368, 'score': 0.777}, {'word': 'come', 'start': 14.529, 'end': 14.912, 'score': 0.838}, {'word': 'campiche', 'start': 15.094, 'end': 16.123, 'score': 0.852}]}, {'start': 16.706, 'end': 18.569, 'text': ' mi ricordano casa', 'words': [{'word': 'mi', 'start': 16.706, 'end': 16.866, 'score': 0.634}, {'word': 'ricordano', 'start': 16.926, 'end': 17.828, 'score': 0.751}, {'word': 'casa', 'start': 18.068, 'end': 18.569, 'score': 0.673}]}, {'start': 20.313, 'end': 22.218, 'text': ' e quel rosso forte.', 'words': [{'word': 'e', 'start': 20.313, 'end': 20.393, 'score': 0.625}, {'word': 'quel', 'start': 20.474, 'end': 20.674, 'score': 0.688}, {'word': 'rosso', 'start': 20.754, 'end': 21.155, 'score': 0.777}, {'word': 'forte.', 'start': 21.376, 'end': 22.218, 'score': 0.83}]}, {'start': 23.478, 'end': 24.954, 'text': ' di quella stanza.', 'words': [{'word': 'di', 'start': 23.478, 'end': 23.579, 'score': 0.578}, {'word': 'quella', 'start': 23.72, 'end': 24.206, 'score': 0.652}, {'word': 'stanza.', 'start': 24.307, 'end': 24.954, 'score': 0.633}]}, {'start': 26.048, 'end': 29.108, 'text': ' e poi non parlo che se parlo non so dire basta', 'words': [{'word': 'e', 'start': 26.048, 'end': 26.088, 'score': 0.566}, {'word': 'poi', 'start': 26.209, 'end': 26.37, 'score': 0.847}, {'word': 'non', 'start': 26.41, 'end': 26.551, 'score': 0.368}, {'word': 'parlo', 'start': 26.611, 'end': 26.933, 'score': 0.861}, {'word': 'che', 'start': 26.994, 'end': 27.115, 'score': 0.838}, {'word': 'se', 'start': 27.215, 'end': 27.316, 'score': 0.835}, {'word': 'parlo', 'start': 27.437, 'end': 27.779, 'score': 0.893}, {'word': 'non', 'start': 27.839, 'end': 27.98, 'score': 0.92}, {'word': 'so', 'start': 28.061, 'end': 28.182, 'score': 0.869}, {'word': 'dire', 'start': 28.242, 'end': 28.484, 'score': 0.652}, {'word': 'basta', 'start': 28.625, 'end': 29.108, 'score': 0.912}]}, {'start': 29.45, 'end': 32.347, 'text': ' ballo o manco avessi preso lezioni di danza', 'words': [{'word': 'ballo', 'start': 29.45, 'end': 29.711, 'score': 0.727}, {'word': 'o', 'start': 29.731, 'end': 29.772, 'score': 0.585}, {'word': 'manco', 'start': 29.832, 'end': 30.114, 'score': 0.721}, {'word': 'avessi', 'start': 30.174, 'end': 30.536, 'score': 0.898}, {'word': 'preso', 'start': 30.637, 'end': 30.959, 'score': 0.972}, {'word': 'lezioni', 'start': 31.059, 'end': 31.562, 'score': 0.924}, {'word': 'di', 'start': 31.663, 'end': 31.743, 'score': 0.978}, {'word': 'danza', 'start': 31.884, 'end': 32.347, 'score': 0.975}]}, {'start': 32.909, 'end': 35.555, 'text': ' Non ho mai avuto paura di essere abbastanza', 'words': [{'word': 'Non', 'start': 32.909, 'end': 33.029, 'score': 0.83}, {'word': 'ho', 'start': 33.069, 'end': 33.169, 'score': 0.279}, {'word': 'mai', 'start': 33.19, 'end': 33.25, 'score': 0.029}, {'word': 'avuto', 'start': 33.27, 'end': 33.53, 'score': 0.686}, {'word': 'paura', 'start': 33.691, 'end': 34.192, 'score': 0.772}, {'word': 'di', 'start': 34.252, 'end': 34.332, 'score': 0.556}, {'word': 'essere', 'start': 34.352, 'end': 34.733, 'score': 0.918}, {'word': 'abbastanza', 'start': 34.794, 'end': 35.555, 'score': 0.954}]}, {'start': 36.017, 'end': 38.485, 'text': ' resto con i piedi in terra si mascalza', 'words': [{'word': 'resto', 'start': 36.017, 'end': 36.238, 'score': 0.681}, {'word': 'con', 'start': 36.318, 'end': 36.458, 'score': 0.809}, {'word': 'i', 'start': 36.519, 'end': 36.559, 'score': 0.695}, {'word': 'piedi', 'start': 36.639, 'end': 36.94, 'score': 0.62}, {'word': 'in', 'start': 36.96, 'end': 37.02, 'score': 0.871}, {'word': 'terra', 'start': 37.08, 'end': 37.381, 'score': 0.978}, {'word': 'si', 'start': 37.522, 'end': 37.662, 'score': 0.837}, {'word': 'mascalza', 'start': 37.743, 'end': 38.485, 'score': 0.904}]}, {'start': 38.927, 'end': 41.636, 'text': ' sempre in salita, tutta la vita', 'words': [{'word': 'sempre', 'start': 38.927, 'end': 39.188, 'score': 0.978}, {'word': 'in', 'start': 39.228, 'end': 39.288, 'score': 0.758}, {'word': 'salita,', 'start': 39.348, 'end': 40.331, 'score': 0.868}, {'word': 'tutta', 'start': 40.592, 'end': 40.954, 'score': 0.626}, {'word': 'la', 'start': 41.034, 'end': 41.215, 'score': 0.938}, {'word': 'vita', 'start': 41.275, 'end': 41.636, 'score': 0.918}]}, {'start': 42.178, 'end': 44.884, 'text': ' Ma mi diceva che intrappaglia lo conquista', 'words': [{'word': 'Ma', 'start': 42.178, 'end': 42.318, 'score': 0.936}, {'word': 'mi', 'start': 42.378, 'end': 42.498, 'score': 0.994}, {'word': 'diceva', 'start': 42.579, 'end': 43.04, 'score': 0.913}, {'word': 'che', 'start': 43.14, 'end': 43.22, 'score': 0.185}, {'word': 'intrappaglia', 'start': 43.26, 'end': 43.902, 'score': 0.57}, {'word': 'lo', 'start': 43.962, 'end': 44.082, 'score': 0.666}, {'word': 'conquista', 'start': 44.183, 'end': 44.884, 'score': 0.922}]}, {'start': 45.407, 'end': 46.695, 'text': " C'erco la fia e chi diria?", 'words': [{'word': "C'erco", 'start': 45.407, 'end': 45.689, 'score': 0.56}, {'word': 'la', 'start': 45.729, 'end': 45.789, 'score': 0.21}, {'word': 'fia', 'start': 45.829, 'end': 45.91, 'score': 0.167}, {'word': 'e', 'start': 45.991, 'end': 46.031, 'score': 0.432}, {'word': 'chi', 'start': 46.152, 'end': 46.212, 'score': 0.145}, {'word': 'diria?', 'start': 46.393, 'end': 46.695, 'score': 0.322}]}, {'start': 48.547, 'end': 51.764, 'text': ' un arco balleno verso la mia conquista.', 'words': [{'word': 'un', 'start': 48.547, 'end': 48.748, 'score': 0.684}, {'word': 'arco', 'start': 48.768, 'end': 48.969, 'score': 0.504}, {'word': 'balleno', 'start': 49.01, 'end': 49.573, 'score': 0.76}, {'word': 'verso', 'start': 49.653, 'end': 50.115, 'score': 0.933}, {'word': 'la', 'start': 50.276, 'end': 50.497, 'score': 0.944}, {'word': 'mia', 'start': 50.558, 'end': 50.779, 'score': 0.949}, {'word': 'conquista.', 'start': 50.96, 'end': 51.764, 'score': 0.797}]}, {'start': 54.572, 'end': 58.187, 'text': ' Su un arco baleno verso la mia conquista', 'words': [{'word': 'Su', 'start': 54.572, 'end': 54.833, 'score': 0.901}, {'word': 'un', 'start': 54.913, 'end': 54.994, 'score': 0.742}, {'word': 'arco', 'start': 55.034, 'end': 55.295, 'score': 0.837}, {'word': 'baleno', 'start': 55.375, 'end': 55.917, 'score': 0.944}, {'word': 'verso', 'start': 56.038, 'end': 56.54, 'score': 0.932}, {'word': 'la', 'start': 56.681, 'end': 56.902, 'score': 0.861}, {'word': 'mia', 'start': 56.962, 'end': 57.203, 'score': 0.816}, {'word': 'conquista', 'start': 57.324, 'end': 58.187, 'score': 0.834}]}], 'word_segments': [{'word': 'Cialo', 'start': 1.099, 'end': 1.4, 'score': 0.491}, {'word': 'come', 'start': 1.58, 'end': 1.921, 'score': 0.587}, {'word': 'il', 'start': 2.041, 'end': 2.081, 'score': 0.157}, {'word': 'sole', 'start': 2.262, 'end': 2.763, 'score': 0.559}, {'word': 'che', 'start': 4.238, 'end': 4.439, 'score': 0.253}, {'word': 'mi', 'start': 4.539, 'end': 4.619, 'score': 0.722}, {'word': 'scalda', 'start': 4.7, 'end': 5.302, 'score': 0.814}, {'word': 'il', 'start': 5.402, 'end': 5.462, 'score': 0.814}, {'word': 'cuore', 'start': 5.643, 'end': 6.104, 'score': 0.904}, {'word': 'e', 'start': 7.556, 'end': 7.616, 'score': 0.531}, {'word': 'blu', 'start': 7.737, 'end': 7.918, 'score': 0.709}, {'word': 'come', 'start': 8.079, 'end': 8.541, 'score': 0.774}, {'word': 'il', 'start': 8.682, 'end': 8.722, 'score': 0.255}, {'word': 'mare.', 'start': 8.803, 'end': 9.306, 'score': 0.681}, {'word': 'che', 'start': 10.646, 'end': 10.828, 'score': 0.488}, {'word': 'sei', 'start': 10.949, 'end': 11.232, 'score': 0.777}, {'word': 'mi', 'start': 11.312, 'end': 11.454, 'score': 0.95}, {'word': 'consopla.', 'start': 11.635, 'end': 12.604, 'score': 0.918}, {'word': 'verde', 'start': 13.844, 'end': 14.368, 'score': 0.777}, {'word': 'come', 'start': 14.529, 'end': 14.912, 'score': 0.838}, {'word': 'campiche', 'start': 15.094, 'end': 16.123, 'score': 0.852}, {'word': 'mi', 'start': 16.706, 'end': 16.866, 'score': 0.634}, {'word': 'ricordano', 'start': 16.926, 'end': 17.828, 'score': 0.751}, {'word': 'casa', 'start': 18.068, 'end': 18.569, 'score': 0.673}, {'word': 'e', 'start': 20.313, 'end': 20.393, 'score': 0.625}, {'word': 'quel', 'start': 20.474, 'end': 20.674, 'score': 0.688}, {'word': 'rosso', 'start': 20.754, 'end': 21.155, 'score': 0.777}, {'word': 'forte.', 'start': 21.376, 'end': 22.218, 'score': 0.83}, {'word': 'di', 'start': 23.478, 'end': 23.579, 'score': 0.578}, {'word': 'quella', 'start': 23.72, 'end': 24.206, 'score': 0.652}, {'word': 'stanza.', 'start': 24.307, 'end': 24.954, 'score': 0.633}, {'word': 'e', 'start': 26.048, 'end': 26.088, 'score': 0.566}, {'word': 'poi', 'start': 26.209, 'end': 26.37, 'score': 0.847}, {'word': 'non', 'start': 26.41, 'end': 26.551, 'score': 0.368}, {'word': 'parlo', 'start': 26.611, 'end': 26.933, 'score': 0.861}, {'word': 'che', 'start': 26.994, 'end': 27.115, 'score': 0.838}, {'word': 'se', 'start': 27.215, 'end': 27.316, 'score': 0.835}, {'word': 'parlo', 'start': 27.437, 'end': 27.779, 'score': 0.893}, {'word': 'non', 'start': 27.839, 'end': 27.98, 'score': 0.92}, {'word': 'so', 'start': 28.061, 'end': 28.182, 'score': 0.869}, {'word': 'dire', 'start': 28.242, 'end': 28.484, 'score': 0.652}, {'word': 'basta', 'start': 28.625, 'end': 29.108, 'score': 0.912}, {'word': 'ballo', 'start': 29.45, 'end': 29.711, 'score': 0.727}, {'word': 'o', 'start': 29.731, 'end': 29.772, 'score': 0.585}, {'word': 'manco', 'start': 29.832, 'end': 30.114, 'score': 0.721}, {'word': 'avessi', 'start': 30.174, 'end': 30.536, 'score': 0.898}, {'word': 'preso', 'start': 30.637, 'end': 30.959, 'score': 0.972}, {'word': 'lezioni', 'start': 31.059, 'end': 31.562, 'score': 0.924}, {'word': 'di', 'start': 31.663, 'end': 31.743, 'score': 0.978}, {'word': 'danza', 'start': 31.884, 'end': 32.347, 'score': 0.975}, {'word': 'Non', 'start': 32.909, 'end': 33.029, 'score': 0.83}, {'word': 'ho', 'start': 33.069, 'end': 33.169, 'score': 0.279}, {'word': 'mai', 'start': 33.19, 'end': 33.25, 'score': 0.029}, {'word': 'avuto', 'start': 33.27, 'end': 33.53, 'score': 0.686}, {'word': 'paura', 'start': 33.691, 'end': 34.192, 'score': 0.772}, {'word': 'di', 'start': 34.252, 'end': 34.332, 'score': 0.556}, {'word': 'essere', 'start': 34.352, 'end': 34.733, 'score': 0.918}, {'word': 'abbastanza', 'start': 34.794, 'end': 35.555, 'score': 0.954}, {'word': 'resto', 'start': 36.017, 'end': 36.238, 'score': 0.681}, {'word': 'con', 'start': 36.318, 'end': 36.458, 'score': 0.809}, {'word': 'i', 'start': 36.519, 'end': 36.559, 'score': 0.695}, {'word': 'piedi', 'start': 36.639, 'end': 36.94, 'score': 0.62}, {'word': 'in', 'start': 36.96, 'end': 37.02, 'score': 0.871}, {'word': 'terra', 'start': 37.08, 'end': 37.381, 'score': 0.978}, {'word': 'si', 'start': 37.522, 'end': 37.662, 'score': 0.837}, {'word': 'mascalza', 'start': 37.743, 'end': 38.485, 'score': 0.904}, {'word': 'sempre', 'start': 38.927, 'end': 39.188, 'score': 0.978}, {'word': 'in', 'start': 39.228, 'end': 39.288, 'score': 0.758}, {'word': 'salita,', 'start': 39.348, 'end': 40.331, 'score': 0.868}, {'word': 'tutta', 'start': 40.592, 'end': 40.954, 'score': 0.626}, {'word': 'la', 'start': 41.034, 'end': 41.215, 'score': 0.938}, {'word': 'vita', 'start': 41.275, 'end': 41.636, 'score': 0.918}, {'word': 'Ma', 'start': 42.178, 'end': 42.318, 'score': 0.936}, {'word': 'mi', 'start': 42.378, 'end': 42.498, 'score': 0.994}, {'word': 'diceva', 'start': 42.579, 'end': 43.04, 'score': 0.913}, {'word': 'che', 'start': 43.14, 'end': 43.22, 'score': 0.185}, {'word': 'intrappaglia', 'start': 43.26, 'end': 43.902, 'score': 0.57}, {'word': 'lo', 'start': 43.962, 'end': 44.082, 'score': 0.666}, {'word': 'conquista', 'start': 44.183, 'end': 44.884, 'score': 0.922}, {'word': "C'erco", 'start': 45.407, 'end': 45.689, 'score': 0.56}, {'word': 'la', 'start': 45.729, 'end': 45.789, 'score': 0.21}, {'word': 'fia', 'start': 45.829, 'end': 45.91, 'score': 0.167}, {'word': 'e', 'start': 45.991, 'end': 46.031, 'score': 0.432}, {'word': 'chi', 'start': 46.152, 'end': 46.212, 'score': 0.145}, {'word': 'diria?', 'start': 46.393, 'end': 46.695, 'score': 0.322}, {'word': 'un', 'start': 48.547, 'end': 48.748, 'score': 0.684}, {'word': 'arco', 'start': 48.768, 'end': 48.969, 'score': 0.504}, {'word': 'balleno', 'start': 49.01, 'end': 49.573, 'score': 0.76}, {'word': 'verso', 'start': 49.653, 'end': 50.115, 'score': 0.933}, {'word': 'la', 'start': 50.276, 'end': 50.497, 'score': 0.944}, {'word': 'mia', 'start': 50.558, 'end': 50.779, 'score': 0.949}, {'word': 'conquista.', 'start': 50.96, 'end': 51.764, 'score': 0.797}, {'word': 'Su', 'start': 54.572, 'end': 54.833, 'score': 0.901}, {'word': 'un', 'start': 54.913, 'end': 54.994, 'score': 0.742}, {'word': 'arco', 'start': 55.034, 'end': 55.295, 'score': 0.837}, {'word': 'baleno', 'start': 55.375, 'end': 55.917, 'score': 0.944}, {'word': 'verso', 'start': 56.038, 'end': 56.54, 'score': 0.932}, {'word': 'la', 'start': 56.681, 'end': 56.902, 'score': 0.861}, {'word': 'mia', 'start': 56.962, 'end': 57.203, 'score': 0.816}, {'word': 'conquista', 'start': 57.324, 'end': 58.187, 'score': 0.834}], 'language': 'it'}
    transcription2 = {"data": {'segments': [{'start': 0.913, 'end': 1.975, 'text': ' calo come il sole', 'words': [{'word': 'calo', 'start': 0.913, 'end': 1.274, 'score': 0.42}, {'word': 'come', 'start': 1.334, 'end': 1.554, 'score': 0.44}, {'word': 'il', 'start': 1.654, 'end': 1.694, 'score': 0.08}, {'word': 'sole', 'start': 1.735, 'end': 1.975, 'score': 0.221}]}, {'start': 4.342, 'end': 5.964, 'text': ' che mi scalda il cuore', 'words': [{'word': 'che', 'start': 4.342, 'end': 4.543, 'score': 0.439}, {'word': 'mi', 'start': 4.583, 'end': 4.663, 'score': 0.342}, {'word': 'scalda', 'start': 4.763, 'end': 5.324, 'score': 0.8}, {'word': 'il', 'start': 5.464, 'end': 5.564, 'score': 0.565}, {'word': 'cuore', 'start': 5.664, 'end': 5.964, 'score': 0.642}]}, {'start': 10.643, 'end': 12.572, 'text': ' che sai mi consulterà.', 'words': [{'word': 'che', 'start': 10.643, 'end': 10.804, 'score': 0.701}, {'word': 'sai', 'start': 10.925, 'end': 11.246, 'score': 0.802}, {'word': 'mi', 'start': 11.326, 'end': 11.467, 'score': 0.856}, {'word': 'consulterà.', 'start': 11.608, 'end': 12.572, 'score': 0.72}]}, {'start': 13.863, 'end': 15.79, 'text': ' verde come i campi...', 'words': [{'word': 'verde', 'start': 13.863, 'end': 14.345, 'score': 0.79}, {'word': 'come', 'start': 14.365, 'end': 14.907, 'score': 0.816}, {'word': 'i', 'start': 14.927, 'end': 14.947, 'score': 0.008}, {'word': 'campi...', 'start': 15.148, 'end': 15.79, 'score': 0.809}]}, {'start': 16.493, 'end': 18.584, 'text': ' mi ricordano casa', 'words': [{'word': 'mi', 'start': 16.493, 'end': 16.674, 'score': 0.482}, {'word': 'ricordano', 'start': 16.996, 'end': 17.88, 'score': 0.622}, {'word': 'casa', 'start': 18.061, 'end': 18.584, 'score': 0.715}]}, {'start': 20.558, 'end': 21.181, 'text': ' ho il rosso forte', 'words': [{'word': 'ho', 'start': 20.558, 'end': 20.619, 'score': 0.119}, {'word': 'il', 'start': 20.639, 'end': 20.759, 'score': 0.258}, {'word': 'rosso', 'start': 20.779, 'end': 21.04, 'score': 0.35}, {'word': 'forte', 'start': 21.06, 'end': 21.181, 'score': 0.18}]}, {'start': 23.428, 'end': 24.952, 'text': ' di quella stanza.', 'words': [{'word': 'di', 'start': 23.428, 'end': 23.529, 'score': 0.708}, {'word': 'quella', 'start': 23.709, 'end': 24.19, 'score': 0.812}, {'word': 'stanza.', 'start': 24.31, 'end': 24.952, 'score': 0.956}]}, {'start': 25.995, 'end': 28.121, 'text': ' le buoni parlo che se parlo non so', 'words': [{'word': 'le', 'start': 25.995, 'end': 26.075, 'score': 0.509}, {'word': 'buoni', 'start': 26.175, 'end': 26.356, 'score': 0.331}, {'word': 'parlo', 'start': 26.617, 'end': 26.918, 'score': 0.552}, {'word': 'che', 'start': 26.998, 'end': 27.078, 'score': 0.337}, {'word': 'se', 'start': 27.198, 'end': 27.259, 'score': 0.349}, {'word': 'parlo', 'start': 27.419, 'end': 27.74, 'score': 0.586}, {'word': 'non', 'start': 27.82, 'end': 27.961, 'score': 0.506}, {'word': 'so', 'start': 28.061, 'end': 28.121, 'score': 0.4}]}, {'start': 28.703, 'end': 32.328, 'text': ' basta ballo manco avessi preso lezioni di danza', 'words': [{'word': 'basta', 'start': 28.703, 'end': 29.163, 'score': 0.868}, {'word': 'ballo', 'start': 29.444, 'end': 29.764, 'score': 0.694}, {'word': 'manco', 'start': 29.804, 'end': 30.125, 'score': 0.718}, {'word': 'avessi', 'start': 30.185, 'end': 30.505, 'score': 0.924}, {'word': 'preso', 'start': 30.625, 'end': 30.946, 'score': 0.929}, {'word': 'lezioni', 'start': 31.046, 'end': 31.466, 'score': 0.863}, {'word': 'di', 'start': 31.647, 'end': 31.747, 'score': 0.78}, {'word': 'danza', 'start': 31.887, 'end': 32.328, 'score': 0.935}]}, {'start': 32.709, 'end': 35.561, 'text': ' Non ho mai avuto paura di essere abbastanza', 'words': [{'word': 'Non', 'start': 32.709, 'end': 32.829, 'score': 0.905}, {'word': 'ho', 'start': 32.889, 'end': 33.171, 'score': 0.52}, {'word': 'mai', 'start': 33.191, 'end': 33.251, 'score': 0.035}, {'word': 'avuto', 'start': 33.271, 'end': 33.532, 'score': 0.637}, {'word': 'paura', 'start': 33.693, 'end': 34.175, 'score': 0.846}, {'word': 'di', 'start': 34.255, 'end': 34.316, 'score': 0.922}, {'word': 'essere', 'start': 34.356, 'end': 34.758, 'score': 0.872}, {'word': 'abbastanza', 'start': 34.798, 'end': 35.561, 'score': 0.925}]}, {'start': 35.903, 'end': 38.504, 'text': ' resto con i piedi in terra si mascalza', 'words': [{'word': 'resto', 'start': 35.903, 'end': 36.286, 'score': 0.724}, {'word': 'con', 'start': 36.327, 'end': 36.407, 'score': 0.475}, {'word': 'i', 'start': 36.528, 'end': 36.548, 'score': 0.858}, {'word': 'piedi', 'start': 36.649, 'end': 36.932, 'score': 0.773}, {'word': 'in', 'start': 36.952, 'end': 36.992, 'score': 0.086}, {'word': 'terra', 'start': 37.073, 'end': 37.395, 'score': 0.825}, {'word': 'si', 'start': 37.516, 'end': 37.677, 'score': 0.797}, {'word': 'mascalza', 'start': 37.738, 'end': 38.504, 'score': 0.926}]}, {'start': 39.027, 'end': 40.854, 'text': ' Sempre in salita, tutta la vita', 'words': [{'word': 'Sempre', 'start': 39.027, 'end': 39.228, 'score': 0.36}, {'word': 'in', 'start': 39.248, 'end': 39.348, 'score': 0.301}, {'word': 'salita,', 'start': 39.368, 'end': 39.71, 'score': 0.448}, {'word': 'tutta', 'start': 39.79, 'end': 40.051, 'score': 0.398}, {'word': 'la', 'start': 40.593, 'end': 40.674, 'score': 0.347}, {'word': 'vita', 'start': 40.734, 'end': 40.854, 'score': 0.319}]}, {'start': 42.039, 'end': 46.437, 'text': ' Ma mi diceva che in Travaglia non conquista vergo la via', 'words': [{'word': 'Ma', 'start': 42.039, 'end': 42.24, 'score': 0.229}, {'word': 'mi', 'start': 42.661, 'end': 42.742, 'score': 0.348}, {'word': 'diceva', 'start': 42.762, 'end': 43.063, 'score': 0.526}, {'word': 'che', 'start': 43.143, 'end': 43.244, 'score': 0.337}, {'word': 'in', 'start': 43.284, 'end': 43.324, 'score': 0.381}, {'word': 'Travaglia', 'start': 43.364, 'end': 43.906, 'score': 0.541}, {'word': 'non', 'start': 43.967, 'end': 44.087, 'score': 0.633}, {'word': 'conquista', 'start': 44.188, 'end': 44.951, 'score': 0.915}, {'word': 'vergo', 'start': 45.372, 'end': 45.774, 'score': 0.855}, {'word': 'la', 'start': 45.794, 'end': 45.874, 'score': 0.644}, {'word': 'via', 'start': 46.135, 'end': 46.437, 'score': 0.572}]}, {'start': 47.139, 'end': 51.009, 'text': ' I miei dirigli a su una boba lano verso la mia con...', 'words': [{'word': 'I', 'start': 47.139, 'end': 47.179, 'score': 0.458}, {'word': 'miei', 'start': 47.219, 'end': 47.34, 'score': 0.269}, {'word': 'dirigli', 'start': 47.44, 'end': 47.981, 'score': 0.491}, {'word': 'a', 'start': 48.041, 'end': 48.082, 'score': 0.806}, {'word': 'su', 'start': 48.182, 'end': 48.322, 'score': 0.848}, {'word': 'una', 'start': 48.482, 'end': 48.643, 'score': 0.515}, {'word': 'boba', 'start': 48.783, 'end': 49.044, 'score': 0.717}, {'word': 'lano', 'start': 49.164, 'end': 49.485, 'score': 0.854}, {'word': 'verso', 'start': 49.625, 'end': 49.986, 'score': 0.836}, {'word': 'la', 'start': 50.247, 'end': 50.307, 'score': 0.556}, {'word': 'mia', 'start': 50.547, 'end': 50.688, 'score': 0.634}, {'word': 'con...', 'start': 50.908, 'end': 51.009, 'score': 0.358}]}, {'start': 51.392, 'end': 51.777, 'text': ' Chi sta?', 'words': [{'word': 'Chi', 'start': 51.392, 'end': 51.534, 'score': 0.479}, {'word': 'sta?', 'start': 51.574, 'end': 51.777, 'score': 0.653}]}, {'start': 54.394, 'end': 58.694, 'text': ' Su un arco ballo verso la mia conquista al...', 'words': [{'word': 'Su', 'start': 54.394, 'end': 54.575, 'score': 0.71}, {'word': 'un', 'start': 54.595, 'end': 54.736, 'score': 0.364}, {'word': 'arco', 'start': 55.037, 'end': 55.318, 'score': 0.822}, {'word': 'ballo', 'start': 55.358, 'end': 55.981, 'score': 0.451}, {'word': 'verso', 'start': 56.082, 'end': 56.504, 'score': 0.921}, {'word': 'la', 'start': 56.644, 'end': 56.926, 'score': 0.726}, {'word': 'mia', 'start': 56.946, 'end': 57.026, 'score': 0.4}, {'word': 'conquista', 'start': 57.107, 'end': 58.453, 'score': 0.702}, {'word': 'al...', 'start': 58.654, 'end': 58.694, 'score': 0.328}]}], 'word_segments': [{'word': 'calo', 'start': 0.913, 'end': 1.274, 'score': 0.42}, {'word': 'come', 'start': 1.334, 'end': 1.554, 'score': 0.44}, {'word': 'il', 'start': 1.654, 'end': 1.694, 'score': 0.08}, {'word': 'sole', 'start': 1.735, 'end': 1.975, 'score': 0.221}, {'word': 'che', 'start': 4.342, 'end': 4.543, 'score': 0.439}, {'word': 'mi', 'start': 4.583, 'end': 4.663, 'score': 0.342}, {'word': 'scalda', 'start': 4.763, 'end': 5.324, 'score': 0.8}, {'word': 'il', 'start': 5.464, 'end': 5.564, 'score': 0.565}, {'word': 'cuore', 'start': 5.664, 'end': 5.964, 'score': 0.642}, {'word': 'che', 'start': 10.643, 'end': 10.804, 'score': 0.701}, {'word': 'sai', 'start': 10.925, 'end': 11.246, 'score': 0.802}, {'word': 'mi', 'start': 11.326, 'end': 11.467, 'score': 0.856}, {'word': 'consulterà.', 'start': 11.608, 'end': 12.572, 'score': 0.72}, {'word': 'verde', 'start': 13.863, 'end': 14.345, 'score': 0.79}, {'word': 'come', 'start': 14.365, 'end': 14.907, 'score': 0.816}, {'word': 'i', 'start': 14.927, 'end': 14.947, 'score': 0.008}, {'word': 'campi...', 'start': 15.148, 'end': 15.79, 'score': 0.809}, {'word': 'mi', 'start': 16.493, 'end': 16.674, 'score': 0.482}, {'word': 'ricordano', 'start': 16.996, 'end': 17.88, 'score': 0.622}, {'word': 'casa', 'start': 18.061, 'end': 18.584, 'score': 0.715}, {'word': 'ho', 'start': 20.558, 'end': 20.619, 'score': 0.119}, {'word': 'il', 'start': 20.639, 'end': 20.759, 'score': 0.258}, {'word': 'rosso', 'start': 20.779, 'end': 21.04, 'score': 0.35}, {'word': 'forte', 'start': 21.06, 'end': 21.181, 'score': 0.18}, {'word': 'di', 'start': 23.428, 'end': 23.529, 'score': 0.708}, {'word': 'quella', 'start': 23.709, 'end': 24.19, 'score': 0.812}, {'word': 'stanza.', 'start': 24.31, 'end': 24.952, 'score': 0.956}, {'word': 'le', 'start': 25.995, 'end': 26.075, 'score': 0.509}, {'word': 'buoni', 'start': 26.175, 'end': 26.356, 'score': 0.331}, {'word': 'parlo', 'start': 26.617, 'end': 26.918, 'score': 0.552}, {'word': 'che', 'start': 26.998, 'end': 27.078, 'score': 0.337}, {'word': 'se', 'start': 27.198, 'end': 27.259, 'score': 0.349}, {'word': 'parlo', 'start': 27.419, 'end': 27.74, 'score': 0.586}, {'word': 'non', 'start': 27.82, 'end': 27.961, 'score': 0.506}, {'word': 'so', 'start': 28.061, 'end': 28.121, 'score': 0.4}, {'word': 'basta', 'start': 28.703, 'end': 29.163, 'score': 0.868}, {'word': 'ballo', 'start': 29.444, 'end': 29.764, 'score': 0.694}, {'word': 'manco', 'start': 29.804, 'end': 30.125, 'score': 0.718}, {'word': 'avessi', 'start': 30.185, 'end': 30.505, 'score': 0.924}, {'word': 'preso', 'start': 30.625, 'end': 30.946, 'score': 0.929}, {'word': 'lezioni', 'start': 31.046, 'end': 31.466, 'score': 0.863}, {'word': 'di', 'start': 31.647, 'end': 31.747, 'score': 0.78}, {'word': 'danza', 'start': 31.887, 'end': 32.328, 'score': 0.935}, {'word': 'Non', 'start': 32.709, 'end': 32.829, 'score': 0.905}, {'word': 'ho', 'start': 32.889, 'end': 33.171, 'score': 0.52}, {'word': 'mai', 'start': 33.191, 'end': 33.251, 'score': 0.035}, {'word': 'avuto', 'start': 33.271, 'end': 33.532, 'score': 0.637}, {'word': 'paura', 'start': 33.693, 'end': 34.175, 'score': 0.846}, {'word': 'di', 'start': 34.255, 'end': 34.316, 'score': 0.922}, {'word': 'essere', 'start': 34.356, 'end': 34.758, 'score': 0.872}, {'word': 'abbastanza', 'start': 34.798, 'end': 35.561, 'score': 0.925}, {'word': 'resto', 'start': 35.903, 'end': 36.286, 'score': 0.724}, {'word': 'con', 'start': 36.327, 'end': 36.407, 'score': 0.475}, {'word': 'i', 'start': 36.528, 'end': 36.548, 'score': 0.858}, {'word': 'piedi', 'start': 36.649, 'end': 36.932, 'score': 0.773}, {'word': 'in', 'start': 36.952, 'end': 36.992, 'score': 0.086}, {'word': 'terra', 'start': 37.073, 'end': 37.395, 'score': 0.825}, {'word': 'si', 'start': 37.516, 'end': 37.677, 'score': 0.797}, {'word': 'mascalza', 'start': 37.738, 'end': 38.504, 'score': 0.926}, {'word': 'Sempre', 'start': 39.027, 'end': 39.228, 'score': 0.36}, {'word': 'in', 'start': 39.248, 'end': 39.348, 'score': 0.301}, {'word': 'salita,', 'start': 39.368, 'end': 39.71, 'score': 0.448}, {'word': 'tutta', 'start': 39.79, 'end': 40.051, 'score': 0.398}, {'word': 'la', 'start': 40.593, 'end': 40.674, 'score': 0.347}, {'word': 'vita', 'start': 40.734, 'end': 40.854, 'score': 0.319}, {'word': 'Ma', 'start': 42.039, 'end': 42.24, 'score': 0.229}, {'word': 'mi', 'start': 42.661, 'end': 42.742, 'score': 0.348}, {'word': 'diceva', 'start': 42.762, 'end': 43.063, 'score': 0.526}, {'word': 'che', 'start': 43.143, 'end': 43.244, 'score': 0.337}, {'word': 'in', 'start': 43.284, 'end': 43.324, 'score': 0.381}, {'word': 'Travaglia', 'start': 43.364, 'end': 43.906, 'score': 0.541}, {'word': 'non', 'start': 43.967, 'end': 44.087, 'score': 0.633}, {'word': 'conquista', 'start': 44.188, 'end': 44.951, 'score': 0.915}, {'word': 'vergo', 'start': 45.372, 'end': 45.774, 'score': 0.855}, {'word': 'la', 'start': 45.794, 'end': 45.874, 'score': 0.644}, {'word': 'via', 'start': 46.135, 'end': 46.437, 'score': 0.572}, {'word': 'I', 'start': 47.139, 'end': 47.179, 'score': 0.458}, {'word': 'miei', 'start': 47.219, 'end': 47.34, 'score': 0.269}, {'word': 'dirigli', 'start': 47.44, 'end': 47.981, 'score': 0.491}, {'word': 'a', 'start': 48.041, 'end': 48.082, 'score': 0.806}, {'word': 'su', 'start': 48.182, 'end': 48.322, 'score': 0.848}, {'word': 'una', 'start': 48.482, 'end': 48.643, 'score': 0.515}, {'word': 'boba', 'start': 48.783, 'end': 49.044, 'score': 0.717}, {'word': 'lano', 'start': 49.164, 'end': 49.485, 'score': 0.854}, {'word': 'verso', 'start': 49.625, 'end': 49.986, 'score': 0.836}, {'word': 'la', 'start': 50.247, 'end': 50.307, 'score': 0.556}, {'word': 'mia', 'start': 50.547, 'end': 50.688, 'score': 0.634}, {'word': 'con...', 'start': 50.908, 'end': 51.009, 'score': 0.358}, {'word': 'Chi', 'start': 51.392, 'end': 51.534, 'score': 0.479}, {'word': 'sta?', 'start': 51.574, 'end': 51.777, 'score': 0.653}, {'word': 'Su', 'start': 54.394, 'end': 54.575, 'score': 0.71}, {'word': 'un', 'start': 54.595, 'end': 54.736, 'score': 0.364}, {'word': 'arco', 'start': 55.037, 'end': 55.318, 'score': 0.822}, {'word': 'ballo', 'start': 55.358, 'end': 55.981, 'score': 0.451}, {'word': 'verso', 'start': 56.082, 'end': 56.504, 'score': 0.921}, {'word': 'la', 'start': 56.644, 'end': 56.926, 'score': 0.726}, {'word': 'mia', 'start': 56.946, 'end': 57.026, 'score': 0.4}, {'word': 'conquista', 'start': 57.107, 'end': 58.453, 'score': 0.702}, {'word': 'al...', 'start': 58.654, 'end': 58.694, 'score': 0.328}], 'language': 'it'}}
    print(f'original transcription {" ".join([segment["text"] for segment in transcription2["data"]["segments"]])}')
    # editor = TranscriptionService("mykey")
    # stored_trans = editor.add_transcription(transcription2)
    # print(editor.get_transcriptions())
    # print(editor.get_transcription(stored_trans["transcription_id"]))
    # print(editor.fit(stored_trans["transcription_id"]))

    # result = editor.fix(stored_trans["transcription_id"])
    # print(f'edited transcription')
    # segments = json.loads(result["choices"][0]["message"]["content"].replace("\'", "\""))
    # print(" ".join([segment["text"]for segment in segments["segments"]]))
